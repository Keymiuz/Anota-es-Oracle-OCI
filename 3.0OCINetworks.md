# Redes Virtuais no OCI (Virtual Cloud Network)

## O que é uma Virtual Cloud Network (VCN)?

A VCN é a rede virtual do Oracle Cloud Infrastructure. É o equivalente a:
* **VPC (Virtual Private Cloud)** na AWS, GCP, DigitalOcean, IBM Cloud, Alibaba.
* **VNet** no Microsoft Azure.

Dentro de uma VCN, você pode adicionar vários componentes de rede para conectar seus recursos.


## Sub-redes (Subnets)

Para alocar recursos (como máquinas virtuais) em uma VCN, você precisa de sub-redes.

* **Public Subnet (Sub-rede Pública):**
    * Permite que os recursos se comuniquem com a internet.
    * Recursos da internet podem iniciar comunicação com os recursos nesta sub-rede.
    * É **opcional** atribuir um endereço IP público a um recurso aqui.

* **Private Subnet (Sub-rede Privada):**
    * Permite que os recursos iniciem comunicação com a internet (através de um NAT Gateway).
    * Recursos da internet **não podem** iniciar comunicação com os recursos nesta sub-rede.
    * **Não é possível** atribuir um endereço IP público a um recurso aqui.


## Gateways de Rede

Gateways fornecem diferentes formas de comunicação para fora da VCN.

* **Internet Gateway:**
    * Permite que recursos em uma **sub-rede pública** acessem a internet.

* **NAT (Network Address Translation) Gateway:**
    * Permite que recursos em uma **sub-rede privada** acessem a internet sem expor seus endereços IP privados.

* **Service Gateway:**
    * Permite que recursos (principalmente em sub-redes privadas) acessem serviços públicos da Oracle (como Object Storage) **sem sair pela internet**. A comunicação permanece dentro da rede do OCI, o que é mais seguro e eficiente.

* **Dynamic Routing Gateway (DRG):**
    * É um produto autônomo que se anexa a uma VCN.
    * É o ponto de entrada/saída para tráfego que não é da internet.
    * Usado para conectar a VCN com:
        * Sua rede local (on-premises) via **FastConnect** ou **VPN**.
        * VCNs em **outras regiões** (Remote Peering).
        * Outros provedores de nuvem.

* **Local Peering Gateway (LPG):**
    * (Não mostrado no diagrama do vídeo)
    * Usado para conectar duas VCNs que estão na **mesma região**.


## Características e Limites da VCN

* **Escopo Regional:** Uma VCN reside em uma **única região** e não pode se estender por várias regiões. Para conectar VCNs em regiões diferentes, usa-se uma conexão de **Remote Peering** através de um DRG.

* **Endereçamento IPv4:**
    * **Múltiplos Blocos CIDR:** Uma VCN pode ter até **5 blocos CIDR IPv4**. Ex: `10.0.0.0/16` e `192.168.0.0/24` na mesma VCN.
    * **Tamanho do Bloco:** O tamanho do bloco CIDR para uma VCN pode variar de `/16` a `/30`.
    * **Modificação:** Você pode modificar um bloco CIDR existente para reduzir seu escopo (ex: de `/16` para `/18`).
    * **Total de IPs:** Embora um `/16` tenha 65.536 endereços, o limite máximo de IPs em uma VCN é de **64.000**.
    * **IPs Reservados:** A VCN sempre reserva 3 endereços IP por sub-rede para uso interno.

* **Endereçamento IPv6:**
    * **Opcional:** O IPv4 é mandatório, mas o IPv6 é opcional.
    * **Prefixos:** Você pode adicionar até **5 prefixos IPv6** a uma VCN. Um é fornecido pelo OCI e os outros quatro podem ser trazidos pelo programa "Bring Your Own IP" (BYOIP).
    * **Acesso à Internet:** Mesmo com um endereço IPv6, um recurso em uma sub-rede privada não terá acesso direto da internet. A classificação "pública" ou "privada" da sub-rede determina o acesso.


## Melhores Práticas

* **Não sobreponha blocos CIDR:** Evite usar o mesmo bloco CIDR em VCNs diferentes. Isso causa problemas se você precisar conectá-las (fazer peering) no futuro.
* **Use os intervalos RFC 1918:** É altamente recomendado usar os intervalos de IP privados definidos na RFC 1918 (ex: `10.0.0.0/8`, `172.16.0.0/12`, `192.168.0.0/16`). Embora tecnicamente possível usar outros, não é uma boa prática.

## Escopo da Sub-rede: Regional vs. Específica de Domínio de Disponibilidade

Esta é uma capacidade importante do OCI, que difere de outros provedores de nuvem.

* **Availability Domain-Specific Subnet (Sub-rede Específica de AD):**
    * **Comportamento:** A sub-rede fica restrita a um único Domínio de Disponibilidade (AD). Você só pode criar recursos nessa sub-rede dentro do AD específico ao qual ela foi designada.
    * **Exemplo:** Uma sub-rede criada para o "AD 1" só pode hospedar recursos no "AD 1".

* **Regional Subnet (Sub-rede Regional):**
    * **Comportamento:** A sub-rede se estende por **todos os Domínios de Disponibilidade** da região, comportando-se de forma semelhante à própria VCN.
    * **Exemplo:** Você pode ter uma única sub-rede regional (ex: Sub-rede D) e alocar uma instância no AD 1, outra no AD 2 e uma terceira no AD 3, todas pertencendo à mesma sub-rede e ao mesmo bloco CIDR.
    * **Importância:** Essencial para configurações de **alta disponibilidade (HA)** e **recuperação de desastres (DR)**. Se um AD falhar (ex: AD 2), os recursos da mesma sub-rede regional que estão em outros ADs (AD 1 e AD 3) não serão afetados.

## Gerenciamento e Endereçamento

* **Redimensionamento:** Depois de criar uma sub-rede, você pode **aumentá-la ou diminuí-la**.
    * **Exemplo:** Um bloco `/24` pode ser dividido em dois `/25` ou quatro `/26`. Você também pode expandir a sub-rede para um `/23`, desde que não haja sobreposição de blocos CIDR.

* **Atribuição de IP:** As instâncias obtêm seu endereço IP privado da sub-rede à qual pertencem.
    * **Automática (Padrão):** Normalmente, um IP do intervalo da sub-rede é atribuído automaticamente quando você cria o recurso.
    * **Manual (Configurável):** Você tem a opção de especificar o endereço IP privado exato que deseja para um recurso durante sua criação (ex: `10.0.4.10`).