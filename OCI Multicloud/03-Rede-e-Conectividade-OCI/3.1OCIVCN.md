# Segurança da Virtual Cloud Network (VCN)

## Security Lists (Listas de Segurança)

Uma **Security List** (SL) funciona como um **firewall virtual** para os recursos dentro de uma VCN.

* **Criação Padrão:** Ao criar uma VCN, ela vem com uma "Default Security List" (Lista de Segurança Padrão).
* **Princípio "Deny by Default":** Inicialmente, todo o tráfego é negado. As regras que você cria são sempre para **conceder acesso** (`allow`).
* **Regra Padrão de SSH:** A lista padrão vem com uma regra que libera a porta 22 (SSH) para toda a internet (`0.0.0.0/0`). **É crucial editar ou remover esta regra** se o acesso SSH aberto não for necessário.
* **Escopo:** As regras de uma Security List se aplicam a **todos os recursos** dentro da(s) sub-rede(s) associada(s) a ela.
* **Aplicação:** As regras são aplicadas no nível da **vNIC** (a placa de rede virtual da instância). Elas controlam o tráfego de entrada e saída da sub-rede, aplicando-se inclusive ao tráfego **dentro da mesma sub-rede**.
* **Associação:** Toda sub-rede **deve** ter pelo menos uma Security List associada. Você pode associar até **cinco** Security Lists por sub-rede.

### Regras Stateful vs. Stateless

* **Stateful (Padrão):**
    * **O que é:** O sistema "lembra" da conexão. Se você permite o tráfego de entrada (ingress), o tráfego de retorno correspondente (egress) é automaticamente permitido, sem a necessidade de uma regra de saída explícita.
    * **Uso:** A maioria das regras são stateful para simplificar a configuração.

* **Stateless:**
    * **O que é:** O sistema **não** rastreia a conexão. Você precisa criar regras explícitas tanto para o tráfego de **entrada (ingress)** quanto para o de **saída (egress)**.
    * **Exemplo:** Se você permitir a porta 80 de entrada, mas não de saída, a resposta do servidor web será bloqueada.
    * **Uso:** Geralmente usado para cenários de alto desempenho com um grande número de conexões, como em Load Balancers, onde um controle mais granular é necessário.

* **Exceção - ICMP (Ping):**
    * O protocolo ICMP, por sua natureza, sempre exige regras de entrada e saída correspondentes, mesmo que seja marcado como "stateful".
    * Regras ICMP para IPv4 **não se aplicam** a IPv6. Você precisa criar regras separadas para `ICMPv6` se sua VCN estiver habilitada para IPv6.


## Network Security Groups (NSGs)

**Network Security Groups** (NSGs) oferecem uma abordagem mais granular para a segurança.

* **Problema que Resolve:** As Security Lists aplicam regras a uma sub-rede inteira. Se você tem 80 instâncias em uma sub-rede, mas apenas uma é um servidor web, a SL aplicaria a regra da porta 80 a todas as 80 instâncias. O NSG resolve isso.
* **Escopo:** Um NSG aplica regras a **recursos individuais** (especificamente, às suas vNICs) ou a um conjunto de recursos que compartilham a mesma postura de segurança, **independentemente da sub-rede em que se encontram**.
* **Associação:** Você pode associar até **cinco** NSGs por vNIC.
* **Recursos Suportados:** NSGs podem ser aplicados a uma vasta gama de recursos, como instâncias de computação, Autonomous Databases, Load Balancers, Mount Targets, etc.

## Security Lists vs. Network Security Groups

* **Trabalhando Juntos (Recomendado):** Você pode usar ambos. A Security List define uma linha de base de segurança para a sub-rede, e os NSGs criam "exceções" ou regras específicas para certos recursos.
* **Usando Apenas Security Lists:** É possível usar apenas SLs, mas pode ser menos granular.
* **Usando Apenas NSGs:** É possível. Para isso, você associaria uma Security List **vazia** (sem regras) à sub-rede e controlaria todo o acesso através de NSGs aplicados a cada recurso.

### Diferença Chave

A capacidade de um NSG usar **outro NSG** como origem ou destino é um recurso muito poderoso, permitindo criar regras de segurança entre camadas de aplicação (ex: permitir que o "NSG-App-Tier" se comunique com o "NSG-DB-Tier") de forma dinâmica e sem depender de endereços IP.