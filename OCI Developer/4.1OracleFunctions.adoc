= Visão Geral do Oracle Functions
:toc:
:icons: font

== O Cenário: A Necessidade de uma Solução Serverless

O desenvolvimento de aplicações modernas frequentemente enfrenta dois desafios principais:
. A necessidade de as equipes de desenvolvimento se concentrarem na lógica de negócio, sem o fardo do gerenciamento de infraestrutura.
. A capacidade de lidar com picos súbitos de tráfego de forma transparente, garantindo performance ótima sem a necessidade de ajustes manuais de escalabilidade.

A computação _Serverless_, e especificamente o serviço Oracle Functions, aborda diretamente esses desafios.

=== O que é Computação Serverless?

Embora o termo "serverless" (sem servidor) possa ser enganoso, pois ainda envolve servidores, a principal característica é que estes servidores são totalmente gerenciados pelos provedores de nuvem. Os usuários não precisam provisionar, configurar ou manter a infraestrutura subjacente.

[NOTE]
====
.Analogia: A Rede Elétrica
Utilizar a computação serverless é como consumir eletricidade em casa. Em vez de instalar painéis solares, baterias e toda a fiação (gerenciar a própria infraestrutura), um usuário simplesmente se conecta à rede elétrica local e paga apenas pela eletricidade que consome. Da mesma forma, com o serverless, o desenvolvedor "conecta" seu código à nuvem, e o provedor gerencia o fornecimento de CPU e memória, cobrando apenas pelo uso efetivo.
====

Com o serverless, os desenvolvedores podem criar e implantar aplicações de forma autônoma, sem a necessidade de envolver equipes de operações no provisionamento e gerenciamento de servidores, otimizando o processo de desenvolvimento e acelerando o _time-to-market_.

== Oracle Functions: Definição e Segurança

*Oracle Functions* é uma plataforma serverless, do tipo *Function-as-a-Service (FaaS)*, totalmente gerenciada e integrada com o Oracle Cloud Infrastructure.

.Características Principais:
* *Integrado com OCI:* Totalmente integrado ao ecossistema da Oracle Cloud.
* *Baseado no Fn Project:* Construído sobre o projeto de código aberto Fn, garantindo robustez e flexibilidade.
* *Container-Native:* As funções são implantadas como imagens de contêiner e executadas em um ambiente nativo de contêiner.

=== Segurança

A segurança é uma prioridade na plataforma. As funções são protegidas utilizando os mecanismos de segurança padrão da OCI, como:
* Networking (VCNs, Security Lists)
* Identity and Access Management (IAM)
* Compartments

Isso garante que as funções operem em um ambiente seguro e controlado.

== Benefícios Principais

*Eficiência de Custo (Pay-per-use)*::
O Oracle Functions opera em um modelo de pagamento por uso. A cobrança ocorre apenas quando as funções estão ativamente em execução. Se as funções estiverem ociosas, não há custo, tornando a solução altamente custo-efetiva.

*Gerenciamento Autônomo*::
A plataforma é autônoma, gerenciando o provisionamento, a gerência e o auto-scaling das funções. Isso permite que as equipes de desenvolvimento se concentrem exclusivamente na escrita e implantação do código, sem o overhead de gerenciamento de infraestrutura.

*Arquitetura Orientada a Eventos*::
É uma plataforma orientada a eventos. Ela se integra com vários serviços da OCI, permitindo que o código da função seja acionado automaticamente com base em eventos específicos, o que facilita a automação e a integração dentro do ambiente de nuvem.

== Experiência de Desenvolvimento e Funcionalidades

=== Abordagem Container-Native

O fato de as funções serem empacotadas e executadas como contêineres é uma vantagem chave. Esta abordagem garante que as funções sejam isoladas, portáteis e escaláveis. Ao encapsular a função e todas as suas dependências em uma imagem de contêiner, garante-se uma execução consistente em diferentes ambientes.

Essa abordagem também permite que bibliotecas de código aberto sejam facilmente empacotadas e reutilizadas como parte das funções, acelerando o processo de desenvolvimento.

=== Suporte a Linguagens (FDKs)

O Oracle Functions oferece *Function Development Kits (FDKs)* para uma variedade de linguagens de programação populares, incluindo:
* Python
* Java
* Go
* Node.js
* Ruby

Os FDKs fornecem um conjunto de ferramentas e bibliotecas que simplificam o desenvolvimento, o deploy e o gerenciamento das funções.

=== Customização Avançada

Para casos de uso mais avançados, a plataforma oferece flexibilidade adicional.

* *Bring Your Own Dockerfile (BYOD) (visto também no outro curso, a ideia é a mesma):*
** Permite customizar a imagem Docker gerada pelo Fn Project, dando total controle sobre o ambiente de execução para atender a necessidades específicas.

* *Otimização com Micronaut e GraalVM Native Image:*
** É possível utilizar o framework de microsserviços *Micronaut* para construir aplicações leves e modulares.
** O uso do *GraalVM Native Image* pode reduzir significativamente o tamanho da imagem de contêiner e o consumo de memória, resultando em tempos de inicialização mais rápidos e menor consumo de recursos.

=== Anotações adicionais:

* Para ser bem honesto, essa parte (de overview inicial) é praticamente a mesma do Multicloud Architect, já feito anteriormente, eu só anotei para não esquecer mesmo, mas se você seguir a mesma base anterior, está de boa.

=== Desenvolvedores de Funções (Function Developers)

São os usuários da OCI que criam e implantam funções. Para interagir com o serviço, eles devem ter contas de usuário válidas e pertencer a grupos de IAM com as políticas apropriadas que concedam as permissões necessárias para criar, implantar e gerenciar recursos de funções.

=== Aplicações (Applications)

Uma Aplicação no OCI Functions é um recurso com múltiplos propósitos:
* *Agrupamento Lógico:* Serve como um agrupamento lógico de funções.
* *Configuração de Recursos:* Permite alocar e configurar recursos comuns a todas as funções dentro dela, como as sub-redes em que serão executadas.
* *Contexto Comum:* Provê um contexto comum para armazenar variáveis de configuração que podem ser acessadas por todas as funções na aplicação.
* *Isolamento de Runtime:* Garante que as execuções de funções de diferentes aplicações permaneçam isoladas umas das outras.

[TIP]
====
A melhor prática para eficiência e performance é agrupar múltiplas funções relacionadas dentro de uma única aplicação.
====

=== Funções (Functions)

A função é o conceito central. É um bloco de código pequeno e focado, projetado para executar uma única tarefa específica.
* *Armazenamento:* Funções são armazenadas como imagens de contêiner em um Container Registry (OCIR) especificado.
* *Metadados:* A definição da função é armazenada como metadados no servidor do OCI Functions. Isso inclui detalhes de execução como a imagem de contêiner a ser usada, o tempo máximo de execução e o consumo máximo de memória permitido.

=== Invocações (Invocations)

É o ato de executar uma função.
* *Métodos:* Funções podem ser invocadas via Fn Project CLI, OCI SDKs, requisições HTTP assinadas para o seu `invoke endpoint`, ou por eventos de outros serviços OCI.
* *Ciclo de Vida (Cold vs. Warm Start):*
. Na *primeira invocação* (cold start), o OCI Functions baixa a imagem do contêiner do registry, a executa como um contêiner e, em seguida, executa a função.
. Para *invocações subsequentes* (warm start), as requisições são direcionadas para o contêiner já em execução, minimizando a latência.
. Após um período de inatividade, o contêiner é removido para otimizar o uso de recursos.

=== Gatilhos (Triggers)

Um trigger é o resultado de uma ação no sistema que envia uma requisição para invocar uma função.
* *Orientado a Eventos:* Iniciado por eventos em outros serviços OCI (ex: um upload de arquivo no Object Storage).
* *Orientado a Tempo:* Agendado para enviar requisições em intervalos definidos (ex: para tarefas periódicas).
Uma função pode não ter nenhum trigger ou estar associada a múltiplos triggers.

== Experiência de Desenvolvimento e Funcionalidades

=== Abordagem Container-Native

O fato de as funções serem empacotadas e executadas como contêineres é uma vantagem chave. Esta abordagem garante que as funções sejam isoladas, portáteis e escaláveis, com uma execução consistente em diferentes ambientes.

=== Suporte a Linguagens e FDKs (Function Development Kits)

O Oracle Functions utiliza os FDKs do Fn Project para suportar diversas linguagens, como Java, Node.js, Python, Go, Ruby e C#. Um FDK é uma coleção de bibliotecas auxiliares que gerenciam os aspectos internos do sistema.

Cada FDK de linguagem é composto por três componentes:
. *Build-time base image:* Imagem com as bibliotecas e ferramentas necessárias para construir a função.
. *Runtime base image:* Imagem com o ambiente necessário para executar a função.
. *FDK library:* Biblioteca que lida com protocolos, passagem de entradas/saídas, etc.

=== O Comando `fn init` e o Arquivo `func.yaml`

Ao criar uma função com o comando `fn init`, especifica-se a linguagem via a opção `--runtime`.
[source,bash]
----
# Exemplo: Inicializando uma função Python
fn init --runtime python <nome-da-funcao>
----
Este comando registra a linguagem e as imagens de build/run correspondentes no arquivo de configuração da função, o `func.yaml`.

.Exemplo de `func.yaml` gerado para Python (versão mais recente)
[source,yaml]
----
schema_version: 20180708
name: helloworld-function
version: 0.0.1
runtime: python
build_image: fnproject/python:3.11-dev
run_image: fnproject/python:3.11
...
----

É possível especificar uma versão exata da linguagem. Para usar Python 3.9, o comando seria `fn init --runtime python3.9 ...`, o que alteraria os valores no `func.yaml`. Para atualizar uma função existente para uma nova versão, basta modificar estes parâmetros no `func.yaml` e executar o comando `fn build`.

=== Customização Avançada

* *Bring Your Own Dockerfile (BYOD):*
** Permite customizar a imagem Docker gerada pelo Fn Project, dando total controle sobre o ambiente de execução.

* *Otimização com Micronaut e GraalVM Native Image:*
** É possível utilizar o framework de microsserviços *Micronaut* e o *GraalVM Native Image* para reduzir significativamente o tamanho da imagem, o consumo de memória e o tempo de inicialização.
